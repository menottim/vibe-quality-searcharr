<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Splintarr{% endblock %}</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">

    <!-- Pico CSS -->
    <link rel="stylesheet" href="/static/css/pico.min.css">
    <link rel="stylesheet" href="/static/css/theme.css">
    <link rel="stylesheet" href="/static/css/custom.css">

    {% block extra_head %}{% endblock %}
</head>
<body>
    {% if user and not no_sidebar %}
    <!-- Authenticated layout: sidebar + content -->
    <div class="app-layout">
        <aside class="sidebar">
            <div class="sidebar-brand">
                <div class="sidebar-brand-icon">S</div>
                <span class="sidebar-brand-text">Splintarr</span>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li>
                        <a href="/dashboard" class="{{ 'active' if active_page == 'dashboard' else '' }}">
                            <span class="nav-icon">&#9673;</span>
                            <span class="nav-label">Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="/dashboard/instances" class="{{ 'active' if active_page == 'instances' else '' }}">
                            <span class="nav-icon">&#9678;</span>
                            <span class="nav-label">Instances</span>
                        </a>
                    </li>
                    <li>
                        <a href="/dashboard/search-queues" class="{{ 'active' if active_page == 'queues' else '' }}">
                            <span class="nav-icon">&#9776;</span>
                            <span class="nav-label">Queues</span>
                        </a>
                    </li>
                    <li>
                        <a href="/dashboard/search-history" class="{{ 'active' if active_page == 'history' else '' }}">
                            <span class="nav-icon">&#9719;</span>
                            <span class="nav-label">History</span>
                        </a>
                    </li>
                </ul>
                <div class="sidebar-section">
                    <ul>
                        <li>
                            <a href="/dashboard/settings" class="{{ 'active' if active_page == 'settings' else '' }}">
                                <span class="nav-icon">&#9881;</span>
                                <span class="nav-label">Settings</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" data-action="logout">
                                <span class="nav-icon">&#9211;</span>
                                <span class="nav-label">Logout</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
        </aside>

        <div class="main-content">
            <!-- Flash messages -->
            {% include "components/flash.html" %}

            <!-- Page content -->
            {% block content %}{% endblock %}

            <!-- Footer -->
            <footer>
                <small>
                    Splintarr v0.1.0 &middot;
                    <a href="https://github.com/menottim/splintarr" target="_blank">GitHub</a>
                </small>
            </footer>
        </div>
    </div>
    {% else %}
    <!-- Unauthenticated layout: no sidebar -->
    {% include "components/flash.html" %}
    {% block unauthenticated_content %}{% endblock %}
    {% endif %}

    <!-- Scripts -->
    <script src="/static/js/app.js" nonce="{{ request.state.csp_nonce }}"></script>
    <script nonce="{{ request.state.csp_nonce }}">
        document.querySelectorAll('[data-action="logout"]').forEach(function(el) {
            el.addEventListener('click', function(e) { e.preventDefault(); logout(); });
        });

        function logout() {
            fetch('/api/auth/logout', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            }).then(() => { window.location.href = '/login'; });
        }
    </script>

    {% block extra_scripts %}{% endblock %}
</body>
</html>
