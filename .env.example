# =============================================================================
# Vibe-Quality-Searcharr Environment Configuration
# =============================================================================
# This file contains all configurable environment variables.
# Copy this file to .env and customize for your environment.
#
# SECURITY WARNING: Never commit .env file to version control!
# =============================================================================

# -----------------------------------------------------------------------------
# Application Settings
# -----------------------------------------------------------------------------

# Application name (displayed in UI and logs)
APP_NAME=Vibe-Quality-Searcharr

# Environment: development, staging, production
# Affects logging, error handling, and security features
ENVIRONMENT=production

# Debug mode: true or false
# WARNING: Never enable in production! Exposes sensitive data in errors
DEBUG=false

# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
# Use DEBUG only for troubleshooting, INFO for production
LOG_LEVEL=INFO

# -----------------------------------------------------------------------------
# Security - CRITICAL CONFIGURATION
# -----------------------------------------------------------------------------
# Generate secure secrets with: ./scripts/generate-secrets.sh
# Or manually: python -c "import secrets; print(secrets.token_urlsafe(64))"

# Method 1: Direct environment variables (simpler, less secure)
# Uncomment and set these if NOT using Docker secrets
#SECRET_KEY=CHANGE_ME_SECRET_KEY_HERE_64_CHARS_MIN
#PEPPER=CHANGE_ME_PEPPER_HERE_32_CHARS_MIN
#DATABASE_KEY=CHANGE_ME_DATABASE_KEY_HERE_32_CHARS_MIN

# Method 2: Docker secrets (RECOMMENDED for production)
# Point to secret files mounted by Docker
SECRET_KEY_FILE=/run/secrets/secret_key
PEPPER_FILE=/run/secrets/pepper
DATABASE_KEY_FILE=/run/secrets/db_key

# IMPORTANT: Use either direct variables OR _FILE variants, not both
# Docker secrets take precedence if both are set

# -----------------------------------------------------------------------------
# Database Configuration
# -----------------------------------------------------------------------------

# SQLite database with SQLCipher encryption
# Format: sqlite+pysqlcipher:///:memory:@<path>?cipher=<cipher>&kdf_iter=<iterations>
DATABASE_URL=sqlite+pysqlcipher:///:memory:@/data/vibe-quality-searcharr.db?cipher=aes-256-cfb&kdf_iter=256000

# Note: Database path should be in a persistent volume for Docker deployments
# The /data directory is typically mounted as a volume

# -----------------------------------------------------------------------------
# Server Configuration
# -----------------------------------------------------------------------------

# Server host
# 0.0.0.0 = listen on all interfaces (required for Docker)
# 127.0.0.1 = localhost only (for local development)
HOST=0.0.0.0

# Server port
PORT=7337

# Auto-reload on code changes (development only)
# WARNING: Never enable in production! Causes security issues
RELOAD=false

# Number of worker processes (for gunicorn in production)
# Set to (2 x CPU cores) + 1 for optimal performance
WORKERS=4

# -----------------------------------------------------------------------------
# Session & Token Configuration
# -----------------------------------------------------------------------------

# Session expiration in hours
# How long a user session stays valid
SESSION_EXPIRE_HOURS=24

# Access token expiration in minutes
# Short-lived token for API requests (15-60 min recommended)
ACCESS_TOKEN_EXPIRE_MINUTES=15

# Refresh token expiration in days
# Long-lived token for obtaining new access tokens (7-30 days recommended)
REFRESH_TOKEN_EXPIRE_DAYS=30

# Maximum number of refresh tokens per user
# Limits the number of devices/sessions per user
MAX_REFRESH_TOKENS=5

# Account lockout duration in minutes (after failed login attempts)
ACCOUNT_LOCKOUT_MINUTES=15

# Maximum failed login attempts before lockout
MAX_LOGIN_ATTEMPTS=5

# -----------------------------------------------------------------------------
# Rate Limiting
# -----------------------------------------------------------------------------

# API rate limit (requests per time period)
# Format: <number>/<period> where period = second, minute, hour, day
# Examples: 100/minute, 1000/hour, 10000/day
API_RATE_LIMIT=100/minute

# Rate limit for authentication endpoints (more restrictive)
AUTH_RATE_LIMIT=10/minute

# Rate limit storage backend
# Options: memory (default), redis
RATE_LIMIT_STORAGE=memory

# Redis URL for rate limiting (if using redis storage)
#REDIS_URL=redis://localhost:6379/0

# -----------------------------------------------------------------------------
# Network Security
# -----------------------------------------------------------------------------

# Allow connections to local Sonarr/Radarr instances
# WARNING: Only enable if you trust your local network
# Recommended: false for production, true for development
ALLOW_LOCAL_INSTANCES=false

# CORS allowed origins (comma-separated)
# Should match your domain(s) accessing the API
# Use * only for development, never in production
ALLOWED_ORIGINS=https://yourdomain.com,https://www.yourdomain.com

# Trusted hosts (comma-separated)
# Protects against Host header injection attacks
ALLOWED_HOSTS=yourdomain.com,www.yourdomain.com

# Enable HTTPS redirect
# Set to true when running behind reverse proxy with SSL
HTTPS_REDIRECT=false

# Strict Transport Security max age (seconds)
# How long browsers should remember to use HTTPS
# 31536000 = 1 year (recommended for production)
HSTS_MAX_AGE=31536000

# -----------------------------------------------------------------------------
# Content Security Policy
# -----------------------------------------------------------------------------

# Content Security Policy header
# Protects against XSS attacks
# Customize based on your needs, default is restrictive
CSP_POLICY=default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self'; connect-src 'self'; frame-ancestors 'none'

# -----------------------------------------------------------------------------
# Search Configuration
# -----------------------------------------------------------------------------

# Maximum items per search batch
# Higher = faster processing, higher API load
MAX_ITEMS_PER_BATCH=50

# Search cooldown period in hours
# Prevents searching same item repeatedly
SEARCH_COOLDOWN_HOURS=24

# Default search strategy
# Options: missing, cutoff_unmet, recent, custom
DEFAULT_SEARCH_STRATEGY=missing

# Maximum concurrent searches per instance
# Prevents overwhelming your indexers
MAX_CONCURRENT_SEARCHES=3

# -----------------------------------------------------------------------------
# Scheduler Configuration
# -----------------------------------------------------------------------------

# Scheduler timezone
# Use IANA timezone names (e.g., America/New_York, Europe/London)
# Default: UTC
SCHEDULER_TIMEZONE=UTC

# Misfire grace time in seconds
# How long to wait before skipping missed jobs
MISFIRE_GRACE_TIME=300

# Job coalescing
# Run missed jobs only once if multiple were missed
COALESCE_JOBS=true

# -----------------------------------------------------------------------------
# Logging Configuration
# -----------------------------------------------------------------------------

# Log format: json or text
# json recommended for production (better parsing)
# text recommended for development (easier reading)
LOG_FORMAT=json

# Log output: file or console
LOG_OUTPUT=console

# Log file path (if LOG_OUTPUT=file)
LOG_FILE=/data/logs/vibe-quality-searcharr.log

# Maximum log file size in MB
LOG_MAX_SIZE=10

# Number of log files to keep
LOG_BACKUP_COUNT=5

# Sanitize sensitive data in logs
# Always true in production!
LOG_SANITIZE=true

# -----------------------------------------------------------------------------
# HTTP Client Configuration
# -----------------------------------------------------------------------------

# HTTP request timeout in seconds
HTTP_TIMEOUT=30

# Maximum retries for failed requests
HTTP_MAX_RETRIES=3

# Connection pool size
HTTP_POOL_SIZE=10

# User agent for outgoing requests
HTTP_USER_AGENT=Vibe-Quality-Searcharr/1.0.0

# -----------------------------------------------------------------------------
# Database Performance
# -----------------------------------------------------------------------------

# SQLite WAL mode (recommended for concurrent access)
# true = better performance, false = safer for network filesystems
SQLITE_WAL_MODE=true

# SQLite cache size in KB
# Higher = better performance, more memory usage
SQLITE_CACHE_SIZE=20000

# SQLite busy timeout in milliseconds
# How long to wait for locks
SQLITE_BUSY_TIMEOUT=5000

# -----------------------------------------------------------------------------
# Feature Flags
# -----------------------------------------------------------------------------

# Enable 2FA (TOTP)
ENABLE_2FA=true

# Enable configuration drift detection
ENABLE_DRIFT_DETECTION=true

# Enable search history tracking
ENABLE_SEARCH_HISTORY=true

# Enable metrics collection
ENABLE_METRICS=false

# Metrics endpoint (if enabled)
METRICS_ENDPOINT=/metrics

# -----------------------------------------------------------------------------
# Docker-Specific Configuration
# -----------------------------------------------------------------------------
# These are typically set in docker-compose.yml but can be overridden

# Container user ID (should match volume ownership)
#PUID=1000
#PGID=1000

# Container timezone
#TZ=UTC

# -----------------------------------------------------------------------------
# Development-Only Settings
# -----------------------------------------------------------------------------
# Only use these in development, never in production!

# Enable API documentation at /docs
# WARNING: Exposes API structure, disable in production
ENABLE_DOCS=false

# Enable test endpoints
# WARNING: Exposes dangerous test-only endpoints
ENABLE_TEST_ENDPOINTS=false

# Disable security features (DANGEROUS!)
# WARNING: Only for testing, never in production
#DISABLE_CSRF=false
#DISABLE_RATE_LIMIT=false
#DISABLE_AUTH=false

# -----------------------------------------------------------------------------
# Monitoring & Observability (Optional)
# -----------------------------------------------------------------------------

# Sentry DSN for error tracking (optional)
#SENTRY_DSN=https://your-sentry-dsn

# Sentry environment
#SENTRY_ENVIRONMENT=production

# Sentry traces sample rate (0.0 to 1.0)
#SENTRY_TRACES_SAMPLE_RATE=0.1

# Prometheus metrics (optional)
#PROMETHEUS_ENABLED=false
#PROMETHEUS_PORT=9090

# -----------------------------------------------------------------------------
# Backup Configuration (for backup scripts)
# -----------------------------------------------------------------------------

# Automatic backup location
BACKUP_DIR=/var/backups/vibe-quality-searcharr

# Number of days to keep backups
BACKUP_RETENTION_DAYS=7

# Backup compression level (1-9, higher = better compression, slower)
BACKUP_COMPRESSION=6

# =============================================================================
# End of Configuration
# =============================================================================

# To get started:
# 1. Copy this file: cp .env.example .env
# 2. Generate secrets: ./scripts/generate-secrets.sh
# 3. Edit .env with your configuration
# 4. Never commit .env to git!
#
# For Docker deployments:
# - Use docker-compose.yml for configuration
# - Store secrets in ./secrets/ directory
# - Mount /data volume for persistence
#
# Security reminders:
# ✓ Generate strong random secrets
# ✓ Never commit secrets to version control
# ✓ Use HTTPS in production
# ✓ Keep software updated
# ✓ Monitor logs regularly
# ✓ Regular backups!
