# v0.5.0 Implementation Plan — UX Overhaul

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Improve first-run experience with expanded setup wizard, guided onboarding, contextual quick actions, search history filters, and a password reset hint.

**Architecture:** All changes are UI/template-level with minimal backend additions. The setup wizard gets 2 new pages (reusing existing Notifications/Prowlarr API endpoints). Empty states get a shared workflow tracker component. The history page gets an inline filter bar using existing API query params. No new models or services.

**Tech Stack:** Python 3.13, FastAPI, Jinja2 templates, Pico CSS, vanilla JS

---

## Task 1: Onboarding State Helper

**Files:**
- Create: `src/splintarr/api/onboarding.py`

Create a helper function that computes the user's onboarding state. This is used by the setup wizard, empty states, and contextual quick actions.

```python
def get_onboarding_state(db: Session, user_id: int) -> dict:
    """Compute onboarding progress for a user.

    Returns dict with keys:
        has_instances: bool
        has_library: bool
        has_queues: bool
        has_searches: bool
        has_notifications: bool
        has_prowlarr: bool
        instance_count: int
        library_count: int
        queue_count: int
        search_count: int
        current_step: int (1-4, the next step the user should take)
        steps: list[dict] with {name, status: "done"|"current"|"next"|"future"}
    """
```

The function queries `Instance`, `LibraryItem`, `SearchQueue`, `SearchHistory`, `NotificationConfig`, and `ProwlarrConfig` counts for the user. The `current_step` is determined by what's missing: no instances -> step 1, no library -> step 2, no queues -> step 3, no searches -> step 4.

**Commit:** `feat: add onboarding state helper for workflow tracking`

---

## Task 2: Setup Wizard — Notifications Step

**Files:**
- Create: `src/splintarr/templates/setup/notifications.html`
- Modify: `src/splintarr/api/dashboard.py` (add route handlers)

Add step 4 of the setup wizard: `/setup/notifications`

**Route handler** (`dashboard.py`): Follow the existing `setup_instance_page` pattern. Require auth via `get_current_user_from_cookie`. Render `setup/notifications.html` with `no_sidebar: True`.

Add a skip route: `GET /setup/notifications/skip` -> redirect to `/setup/prowlarr`.

**Template** (`setup/notifications.html`): Extends `base.html`, uses `unauthenticated_content` block. Progress bar shows 6 steps (Welcome, Admin, Instance, **Notifications**, Prowlarr, Complete) with steps 1-3 marked completed.

Form fields (same as Settings Discord section):
- Webhook URL input with placeholder
- Test button (auto-saves + tests, same JS as Settings v0.4.1)
- Skip button: "Skip, I'll set this up later" -> `/setup/notifications/skip`
- Continue button -> `/setup/prowlarr`

The form POSTs to the existing `/api/notifications/config` endpoint (already exists). On success, redirect to `/setup/prowlarr`.

**Update setup flow**: Change `setup_instance_page` POST success redirect from `/setup/complete` to `/setup/notifications`. Change `setup_instance_skip` redirect from `/setup/complete` to `/setup/notifications`.

**Commit:** `feat: add notifications step to setup wizard`

---

## Task 3: Setup Wizard — Prowlarr Step

**Files:**
- Create: `src/splintarr/templates/setup/prowlarr.html`
- Modify: `src/splintarr/api/dashboard.py` (add route handlers)

Add step 5: `/setup/prowlarr`

Same pattern as Task 2. Progress bar shows steps 1-4 completed. Form uses existing `/api/prowlarr/config` and `/api/prowlarr/test` endpoints.

Fields: Prowlarr URL (with Docker hints), API key, Verify SSL checkbox, Test Connection button (auto-save + test). Skip -> `/setup/complete`. Continue -> `/setup/complete`.

**Update flow**: Notifications Continue/Skip both point to `/setup/prowlarr`.

**Commit:** `feat: add Prowlarr step to setup wizard`

---

## Task 4: Setup Complete — Show Configuration Summary

**Files:**
- Modify: `src/splintarr/templates/setup/complete.html`
- Modify: `src/splintarr/api/dashboard.py` (pass onboarding state to template)

Update the setup complete page to show what was configured vs skipped.

In the `setup_complete` route handler, call `get_onboarding_state()` and pass it to the template.

In the template, replace the generic "What's Next?" list with a summary:

```
Configuration Summary:
- Admin Account:    ✓ Created
- Instance:         ✓ Configured (or ○ Skipped — add one from Settings)
- Notifications:    ✓ Configured (or ○ Skipped — add from Settings)
- Prowlarr:         ✓ Configured (or ○ Skipped — add from Settings)
```

Keep the existing "Tips for Getting Started" section.

**Commit:** `feat: show configuration summary on setup complete page`

---

## Task 5: Guided Onboarding Empty States

**Files:**
- Create: `src/splintarr/templates/components/onboarding_steps.html`
- Modify: `src/splintarr/templates/dashboard/library.html`
- Modify: `src/splintarr/templates/dashboard/search_queues.html`
- Modify: `src/splintarr/templates/dashboard/search_history.html`
- Modify: `src/splintarr/templates/dashboard/exclusions.html`
- Modify: `src/splintarr/api/dashboard.py` (pass onboarding state to page renders)
- Modify: `src/splintarr/api/library.py` (pass onboarding state)
- Modify: `src/splintarr/api/search_history.py` (pass onboarding state)
- Modify: `src/splintarr/api/exclusions.py` (pass onboarding state)

Create a reusable Jinja2 component `onboarding_steps.html`:

```html
{# Include with: {% include "components/onboarding_steps.html" %} #}
{# Requires: onboarding variable in template context #}
{% if onboarding and not onboarding.has_searches %}
<article style="margin-bottom: 1.5rem;">
    <h4>Getting Started</h4>
    <ol>
        {% for step in onboarding.steps %}
        <li style="{% if step.status == 'done' %}color: var(--ins-color);{% elif step.status == 'current' %}font-weight: bold;{% else %}color: var(--muted-color);{% endif %}">
            {% if step.status == 'done' %}✓{% elif step.status == 'current' %}→{% else %}○{% endif %}
            {{ step.name }}
            {% if step.status == 'current' and step.url %}
            — <a href="{{ step.url }}">{{ step.action }}</a>
            {% endif %}
        </li>
        {% endfor %}
    </ol>
</article>
{% endif %}
```

Each page handler calls `get_onboarding_state()` and passes it as `onboarding` in the template context. The component is included in the empty-state blocks of each page. It auto-hides once the user has completed all 4 steps (has_searches is True).

The steps include URLs for the "current" step action:
- Step 1: "Add now" -> /dashboard/instances
- Step 2: "Sync now" -> /dashboard/library (with Refresh Library button)
- Step 3: "Create now" -> /dashboard/search-queues
- Step 4: "Run a search" -> /dashboard/search-queues

**Commit:** `feat: add guided onboarding workflow tracker to empty states`

---

## Task 6: Contextual Dashboard Quick Actions

**Files:**
- Modify: `src/splintarr/templates/dashboard/index.html`
- Modify: `src/splintarr/api/dashboard.py` (pass onboarding state to dashboard)

In the dashboard render handler, call `get_onboarding_state()` and pass it to the template.

Replace the static Quick Actions card with contextual content:

```html
<article>
    <h4>Quick Actions</h4>
    {% if not onboarding.has_instances %}
    <p><strong><a href="/dashboard/instances">→ Add your first instance</a></strong></p>
    <p><small style="color: var(--muted-color);">Connect Sonarr or Radarr to get started</small></p>
    {% elif not onboarding.has_library %}
    <p><strong><a href="/dashboard/library">→ Sync your library</a></strong></p>
    <p><small style="color: var(--muted-color);">Pull series and movie data from your instances</small></p>
    <p><a href="/dashboard/instances">Manage Instances</a></p>
    {% elif not onboarding.has_queues %}
    <p><strong><a href="/dashboard/search-queues">→ Create your first search queue</a></strong></p>
    <p><small style="color: var(--muted-color);">Set up automated backlog searching</small></p>
    <p><a href="/dashboard/library">Browse Library</a></p>
    <p><a href="/dashboard/instances">Manage Instances</a></p>
    {% else %}
    <p><a href="/dashboard/library">Browse Library</a></p>
    <p><a href="/dashboard/search-queues">Create Search Queue</a></p>
    <p><a href="/dashboard/instances">Add Instance</a></p>
    <p><a href="/dashboard/search-history">View History</a></p>
    {% endif %}
</article>
```

**Commit:** `feat: contextual quick actions based on onboarding state`

---

## Task 7: Search History Filter Bar

**Files:**
- Modify: `src/splintarr/templates/dashboard/search_history.html`
- Modify: `src/splintarr/api/search_history.py` (the HTML-rendering GET route, pass filter values + instances to template)

Add an inline filter bar above the history table. The backend route (`GET /dashboard/search-history`) already renders a template — update it to:
1. Accept query params: `instance_id`, `strategy`, `status`, `start_date`, `end_date`
2. Pass them through to the `SearchHistoryService` call
3. Pass the current filter values + instance list to the template for pre-populating dropdowns

The filter bar HTML:

```html
<div style="display: flex; gap: 0.5rem; margin-bottom: 1.5rem; flex-wrap: wrap; align-items: end;">
    <label style="margin-bottom: 0;">
        <small>Instance</small>
        <select id="filter-instance" onchange="applyHistoryFilters()">
            <option value="">All Instances</option>
            {% for inst in instances %}
            <option value="{{ inst.id }}" {% if filters.instance_id == inst.id %}selected{% endif %}>{{ inst.name }}</option>
            {% endfor %}
        </select>
    </label>
    <label style="margin-bottom: 0;">
        <small>Strategy</small>
        <select id="filter-strategy" onchange="applyHistoryFilters()">
            <option value="">All</option>
            <option value="missing" {% if filters.strategy == 'missing' %}selected{% endif %}>Missing</option>
            <option value="cutoff_unmet" {% if filters.strategy == 'cutoff_unmet' %}selected{% endif %}>Cutoff Unmet</option>
            <option value="recent" {% if filters.strategy == 'recent' %}selected{% endif %}>Recent</option>
        </select>
    </label>
    <label style="margin-bottom: 0;">
        <small>Status</small>
        <select id="filter-status" onchange="applyHistoryFilters()">
            <option value="">All</option>
            <option value="completed" {% if filters.status == 'completed' %}selected{% endif %}>Completed</option>
            <option value="failed" {% if filters.status == 'failed' %}selected{% endif %}>Failed</option>
        </select>
    </label>
    {% if filters.instance_id or filters.strategy or filters.status %}
    <a href="/dashboard/search-history" style="font-size: 0.875rem;">Clear filters</a>
    {% endif %}
</div>
```

JS function `applyHistoryFilters()` builds query params from the dropdowns and navigates to the URL (same pattern as library filters).

Also fix terminology in this template: `items_searched` -> "Searched" (using `searches_triggered` with fallback), `items_found` -> "Eligible".

Remove the stale "Filters" card at the bottom that links to the raw API.

**Commit:** `feat: add inline filter bar to search history page`

---

## Task 8: Login Password Reset Hint

**Files:**
- Modify: `src/splintarr/templates/auth/login.html`

Add a muted hint below the login form, inside the `<article>`:

```html
<small style="display: block; text-align: center; margin-top: 1rem; color: var(--muted-color);">
    Forgot your password? Reset via CLI:<br>
    <code style="font-size: 0.75rem;">docker exec splintarr splintarr reset-password</code>
</small>
```

**Commit:** `feat: add password reset CLI hint on login page`

---

## Task 9: Lint, Test, Final Verification

Run full lint and test suite. Verify zero new failures.

**Commit:** `chore: lint and format for v0.5.0`
